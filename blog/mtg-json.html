<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="wilcoforr's home GitHub site">
    <meta name="author" content="wilcoforr">

    <title>wilcoforr - MTG JSON</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="icon" href="../images/favicon.ico">

    <link href="../css/styles.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css" rel="stylesheet" />
    <link ref="https://cdn.datatables.net/2.3.2/css/dataTables.bootstrap5.css" rel="stylesheet">

    <style>
        .uncommon {
            color: silver;
        }

        .rare {
            color: orange;
        }

        .mythic {
            color: orangered;
        }
    </style>
</head>

<body>
    <header>
        <div class="collapse bg-dark" id="navbarHeader">
            <div class="container">
                <div class="row">
                    <div class="col-sm-8 col-md-7 py-4">
                        <h4 class="text-white">wilcoforr</h4>
                        <p class="text-muted">Full stack .NET software developer.</p>
                    </div>
                    <div class="col-sm-4 offset-md-1 py-4">
                        <h4 class="text-white">More Info</h4>
                        <ul class="list-unstyled">
                            <li><a href="https://wilcoforr.github.io/" class="text-white">Home</a></li>
                            <li>
                                <a href="https://wilcoforr.github.io/blog/blog.html"
                                   class="text-white">Blog</a>
                            </li>
                            <li><a href="https://www.github.com/wilcoforr/" class="text-white">My GitHub</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="navbar navbar-dark bg-dark shadow-sm">
            <div class="container">
                <a href="https://wilcoforr.github.io/" class="navbar-brand d-flex align-items-center">
                    <strong>wilcoforr</strong>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader"
                        aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="container body-content">


            <section class="section">
                <div class="container">
                    <h1 class="title">
                        MTG JSON
                    </h1>
                    <p>
                        Using some of the latest JavaScript features to generate a table of Magic the Gathering
                        Cards from MTG JSON (https://mtgjson.com/downloads/all-sets/), Innistrad: Remastered expansion.
                    </p>
                    <p>Tech used: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Fetch API</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">Async</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template Literals/strings</a>, and <a href="https://datatables.net/">DataTables</a>.</p>
                    <hr>
                    <table id="cards" class="table table-striped">
                        <thead>
                            <tr>
                                <td>Name</td>
                                <td>Card</td>
                                <td>Type</td>
                                <td>Text</td>
                                <td>Flavor Text</td>
                                <td>Rarity</td>
                            </tr>
                        </thead>
                        <tbody id="cardsTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <template id="cardRow">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </template>

        </div>
    </main>

    <footer class="pt-5 my-5 text-muted border-top text-center">
        wilcoforr &middot; &copy; <span id="lastModified"></span>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="../js/script.js"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/1.12.0/js/dataTables.bootstrap5.min.js"></script>

    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.min.js"></script>

    <script>

        if (!("content" in document.createElement("template"))) {
            window.alert("Template not supported in this browser. This page will not load correctly.");
        }

        (async () => {

            //fetch API - https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
            const vow = fetch("https://mtgjson.com/api/v5/INR.json");

            const vowRes = await vow;
            const vowResJson = await vowRes.json();

            const cards = vowResJson.data.cards;
            const template = document.getElementById("cardRow");

            // Track unique card names
            const seenNames = new Set();

            for (let i = 0; i < cards.length; i++) {

                const card = cards[i];

                // Skip if we've already seen this card name
                if (seenNames.has(card.name)) continue;
                seenNames.add(card.name);

                let tcgPlayerIdentifier = cards[i].identifiers.tcgplayerProductId;
                let tcgplayerImageUrl = `https://tcgplayer-cdn.tcgplayer.com/product/${tcgPlayerIdentifier}_in_1000x1000.jpg`;

                // Use template literals for building image HTML
                let imageSrcBuilderHTML = "";

                if (tcgPlayerIdentifier == undefined) {
                    imageSrcBuilderHTML = `<span title='Image not found (${tcgplayerImageUrl})'>-</span>`;
                }
                else {
                    imageSrcBuilderHTML = `<a href="${tcgplayerImageUrl}"><img class="img" src="${tcgplayerImageUrl}" height="250"></a>`
                }

                const cardRowClone = template.content.cloneNode(true);
                const tds = cardRowClone.querySelectorAll("td");

                tds[0].innerHTML = `<strong>${card.name}</strong>`;
                tds[1].innerHTML = imageSrcBuilderHTML;

                let typeAndPowerToughnessText = card.type;
                if (card.type.startsWith("Creature")) {
                    typeAndPowerToughnessText += " [" + card.power + "/" + card.toughness + "]";
                }
                tds[2].textContent = typeAndPowerToughnessText;

                tds[3].textContent = card.text;
                tds[4].textContent = card.flavorText;

                tds[5].innerHTML = `<span class="${card.rarity}">${card.rarity}</span>`;;

                // add the row containing the card info to the table body
                document.getElementById("cardsTableBody").appendChild(cardRowClone);
            }

            //DataTable init
            let cardTable = new DataTable("#cards");
        })();
    </script>
</body>

</html>
